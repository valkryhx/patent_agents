# ä¸“åˆ©ç”Ÿæˆæ™ºèƒ½ä½“ç³»ç»Ÿ API

## æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäºFastAPIçš„ä¸“åˆ©æ’°å†™æ™ºèƒ½ä½“ç³»ç»Ÿï¼Œæä¾›RESTful APIæ¥å£æ¥ç”Ÿæˆä¸“åˆ©ã€‚ç³»ç»Ÿæ”¯æŒæµ‹è¯•æ¨¡å¼å’ŒçœŸå®æ¨¡å¼ï¼Œå¯ä»¥å¤„ç†ä¸åŒçš„ä¸“åˆ©ä¸»é¢˜ã€‚

## ä¸»è¦åŠŸèƒ½

- ğŸš€ **ä¸“åˆ©ç”Ÿæˆ**: é€šè¿‡POSTæ¥å£å¯åŠ¨ä¸“åˆ©æ’°å†™å·¥ä½œæµ
- ğŸ” **çŠ¶æ€æŸ¥è¯¢**: å®æ—¶æŸ¥è¯¢å·¥ä½œæµæ‰§è¡ŒçŠ¶æ€å’Œè¿›åº¦
- ğŸ“‹ **å·¥ä½œæµç®¡ç†**: åˆ—å‡ºã€é‡å¯ã€åˆ é™¤å·¥ä½œæµ
- ğŸ§ª **æµ‹è¯•æ¨¡å¼**: æ”¯æŒæµ‹è¯•æ¨¡å¼ï¼Œå¿«é€ŸéªŒè¯åŠŸèƒ½
- ğŸ”’ **å·¥ä½œæµéš”ç¦»**: æ¯ä¸ªå·¥ä½œæµéƒ½æœ‰ç‹¬ç«‹çš„æ‰§è¡Œç¯å¢ƒ

## API ç«¯ç‚¹

### 1. ä¸“åˆ©ç”Ÿæˆ

#### POST `/patent/generate`
å¯åŠ¨ä¸€ä¸ªæ–°çš„ä¸“åˆ©æ’°å†™å·¥ä½œæµ

**è¯·æ±‚ä½“:**
```json
{
    "topic": "åŒºå—é“¾",
    "description": "åŸºäºåŒºå—é“¾æŠ€æœ¯çš„çŸ¥è¯†äº§æƒç®¡ç†ç³»ç»Ÿ",
    "test_mode": true
}
```

**å‚æ•°è¯´æ˜:**
- `topic` (å¿…éœ€): ä¸“åˆ©ä¸»é¢˜
- `description` (å¯é€‰): ä¸“åˆ©æè¿°ï¼Œå¦‚æœä¸æä¾›ä¼šè‡ªåŠ¨ç”Ÿæˆ
- `test_mode` (å¯é€‰): æ˜¯å¦å¯ç”¨æµ‹è¯•æ¨¡å¼ï¼Œé»˜è®¤false

**å“åº”ç¤ºä¾‹:**
```json
{
    "workflow_id": "3e8cc09f-dc42-4955-9faa-0d63bf80d3ac",
    "status": "started",
    "message": "Patent generation started for topic: åŒºå—é“¾ (test_mode: True)"
}
```

### 2. çŠ¶æ€æŸ¥è¯¢

#### GET `/patent/{workflow_id}/status`
æŸ¥è¯¢ä¸“åˆ©å·¥ä½œæµçš„çŠ¶æ€å’Œè¿›åº¦

**å“åº”ç¤ºä¾‹:**
```json
{
    "workflow_id": "3e8cc09f-dc42-4955-9faa-0d63bf80d3ac",
    "topic": "åŒºå—é“¾",
    "status": "running",
    "test_mode": true,
    "current_stage": 0,
    "total_stages": 6,
    "progress": 0.0,
    "stages": [
        {
            "name": "planning",
            "status": "running",
            "start_time": 1755446618.236344,
            "end_time": null,
            "result": null,
            "error": null
        }
    ],
    "created_at": 1755446618.2360127,
    "updated_at": 1755446618.2593486
}
```

### 3. å·¥ä½œæµç®¡ç†

#### GET `/patents`
åˆ—å‡ºæ‰€æœ‰ä¸“åˆ©å·¥ä½œæµ

#### GET `/workflows`
åˆ—å‡ºæ‰€æœ‰å·¥ä½œæµï¼ˆåŒ…æ‹¬éä¸“åˆ©å·¥ä½œæµï¼‰

#### POST `/patent/{workflow_id}/restart`
é‡å¯å¤±è´¥çš„ä¸“åˆ©å·¥ä½œæµ

#### DELETE `/patent/{workflow_id}`
åˆ é™¤ä¸“åˆ©å·¥ä½œæµ

### 4. ç³»ç»ŸçŠ¶æ€

#### GET `/health`
ç³»ç»Ÿå¥åº·æ£€æŸ¥

#### GET `/`
æ ¹ç«¯ç‚¹ï¼Œæ˜¾ç¤ºç³»ç»Ÿä¿¡æ¯

## ä½¿ç”¨ç¤ºä¾‹

### 1. å¯åŠ¨åŒºå—é“¾ä¸“åˆ©ç”Ÿæˆï¼ˆæµ‹è¯•æ¨¡å¼ï¼‰

```bash
curl -X POST "http://localhost:8000/patent/generate" \
  -H "Content-Type: application/json" \
  -d '{
    "topic": "åŒºå—é“¾",
    "description": "åŸºäºåŒºå—é“¾æŠ€æœ¯çš„çŸ¥è¯†äº§æƒç®¡ç†ç³»ç»Ÿ",
    "test_mode": true
  }'
```

### 2. å¯åŠ¨AIä¸“åˆ©ç”Ÿæˆï¼ˆçœŸå®æ¨¡å¼ï¼‰

```bash
curl -X POST "http://localhost:8000/patent/generate" \
  -H "Content-Type: application/json" \
  -d '{
    "topic": "äººå·¥æ™ºèƒ½",
    "description": "åŸºäºæ·±åº¦å­¦ä¹ çš„æ™ºèƒ½å›¾åƒè¯†åˆ«ç³»ç»Ÿ",
    "test_mode": false
  }'
```

### 3. æŸ¥è¯¢å·¥ä½œæµçŠ¶æ€

```bash
curl "http://localhost:8000/patent/{workflow_id}/status"
```

### 4. åˆ—å‡ºæ‰€æœ‰ä¸“åˆ©å·¥ä½œæµ

```bash
curl "http://localhost:8000/patents"
```

## å·¥ä½œæµé˜¶æ®µ

ç³»ç»ŸåŒ…å«ä»¥ä¸‹6ä¸ªé˜¶æ®µï¼š

1. **Planning** (è§„åˆ’): åˆ¶å®šä¸“åˆ©æ’°å†™ç­–ç•¥
2. **Search** (æœç´¢): æœç´¢ç°æœ‰æŠ€æœ¯å’Œä¸“åˆ©
3. **Discussion** (è®¨è®º): è®¨è®ºåˆ›æ–°ç‚¹å’Œä¼˜åŠ¿
4. **Drafting** (æ’°å†™): æ’°å†™ä¸“åˆ©æ–‡æ¡£
5. **Review** (å®¡æŸ¥): å®¡æŸ¥ä¸“åˆ©è´¨é‡
6. **Rewrite** (é‡å†™): æ ¹æ®åé¦ˆè¿›è¡Œä¿®æ”¹

## æµ‹è¯•æ¨¡å¼ vs çœŸå®æ¨¡å¼

### æµ‹è¯•æ¨¡å¼ (`test_mode: true`)
- å¿«é€Ÿæ‰§è¡Œï¼Œç”¨äºåŠŸèƒ½éªŒè¯
- è·³è¿‡LLMè°ƒç”¨ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
- é€‚åˆå¼€å‘å’Œæµ‹è¯•ç¯å¢ƒ

### çœŸå®æ¨¡å¼ (`test_mode: false`)
- å®Œæ•´æ‰§è¡Œæ‰€æœ‰é˜¶æ®µ
- è°ƒç”¨çœŸå®çš„AIæœåŠ¡
- é€‚åˆç”Ÿäº§ç¯å¢ƒ

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FastAPI App   â”‚    â”‚ WorkflowManager â”‚    â”‚  Agent Services â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚  /patent/*      â”‚â—„â”€â”€â–ºâ”‚  Task Assignmentâ”‚â—„â”€â”€â–ºâ”‚  Planner       â”‚
â”‚  /workflow/*    â”‚    â”‚  State Mgmt     â”‚    â”‚  Searcher      â”‚
â”‚  /health        â”‚    â”‚  Progress Track â”‚    â”‚  Discusser     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  Writer        â”‚
                                              â”‚  Reviewer      â”‚
                                              â”‚  Rewriter      â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å¯åŠ¨æœåŠ¡

```bash
# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# å¯åŠ¨æœåŠ¡
python3 main.py
```

æœåŠ¡å°†åœ¨ `http://localhost:8000` å¯åŠ¨

## API æ–‡æ¡£

å¯åŠ¨æœåŠ¡åï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®APIæ–‡æ¡£ï¼š

- Swagger UI: `http://localhost:8000/docs`
- ReDoc: `http://localhost:8000/redoc`
- OpenAPI JSON: `http://localhost:8000/openapi.json`

## æ³¨æ„äº‹é¡¹

1. **AgentæœåŠ¡**: å½“å‰åªå¯åŠ¨äº†åè°ƒå™¨æœåŠ¡ï¼ŒagentæœåŠ¡éœ€è¦å•ç‹¬å¯åŠ¨
2. **å·¥ä½œæµçŠ¶æ€**: ç”±äºagentæœåŠ¡æœªè¿è¡Œï¼Œå·¥ä½œæµä¼šæ˜¾ç¤ºä¸ºfailedçŠ¶æ€
3. **æµ‹è¯•æ¨¡å¼**: å»ºè®®åœ¨å¼€å‘é˜¶æ®µä½¿ç”¨æµ‹è¯•æ¨¡å¼
4. **é”™è¯¯å¤„ç†**: ç³»ç»ŸåŒ…å«å®Œæ•´çš„é”™è¯¯å¤„ç†å’ŒçŠ¶æ€è·Ÿè¸ª

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æœåŠ¡æ— æ³•å¯åŠ¨**: æ£€æŸ¥ç«¯å£8000æ˜¯å¦è¢«å ç”¨
2. **å¯¼å…¥é”™è¯¯**: ç¡®ä¿æ‰€æœ‰ä¾èµ–å·²æ­£ç¡®å®‰è£…
3. **å·¥ä½œæµå¤±è´¥**: æ£€æŸ¥agentæœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ

### æ—¥å¿—æŸ¥çœ‹

æœåŠ¡å¯åŠ¨æ—¶ä¼šæ˜¾ç¤ºè¯¦ç»†çš„æ—¥å¿—ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š
- å·¥ä½œæµåˆ›å»ºå’ŒçŠ¶æ€æ›´æ–°
- ä»»åŠ¡åˆ†é…å’Œæ‰§è¡Œ
- é”™è¯¯ä¿¡æ¯å’Œè°ƒè¯•ä¿¡æ¯

## å¼€å‘è¯´æ˜

### ä»£ç ç»“æ„

- `main.py`: FastAPIåº”ç”¨ä¸»æ–‡ä»¶
- `models.py`: æ•°æ®æ¨¡å‹å®šä¹‰
- `workflow_manager.py`: å·¥ä½œæµç®¡ç†å™¨
- `test_patent_api.py`: APIæµ‹è¯•è„šæœ¬

### æ‰©å±•åŠŸèƒ½

ç³»ç»Ÿè®¾è®¡ä¸ºå¯æ‰©å±•æ¶æ„ï¼Œå¯ä»¥è½»æ¾æ·»åŠ ï¼š
- æ–°çš„agentæœåŠ¡
- ä¸åŒçš„å·¥ä½œæµç±»å‹
- è‡ªå®šä¹‰çš„æµ‹è¯•æ¨¡å¼é…ç½®
- æ›´å¤šçš„APIç«¯ç‚¹