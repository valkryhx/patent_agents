#!/usr/bin/env python3
"""
Detailed Test Script for Patent Agent Test Mode
Shows the actual content generated by each agent
"""

import asyncio
import logging
import sys
import os
import time
import json
from typing import Dict, Any, List

# Configure logging
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)

# Mock classes for testing
class MockMessageBus:
    """Mock message bus for testing"""
    
    def __init__(self):
        self.messages = []
        self.agents = {}
        
    async def register_agent(self, name: str, capabilities: List[str]):
        self.agents[name] = capabilities
        print(f"âœ… Registered agent: {name} with capabilities: {capabilities}")
        
    async def unregister_agent(self, name: str):
        if name in self.agents:
            del self.agents[name]
            print(f"âœ… Unregistered agent: {name}")
            
    async def send_message(self, message):
        self.messages.append(message)
        print(f"ğŸ“¨ Message sent: {message.get('type', 'unknown')} from {message.get('sender', 'unknown')}")
        
    async def get_message(self, agent_name: str):
        # Return None to simulate no messages
        return None

class MockContextManager:
    """Mock context manager for testing"""
    
    def __init__(self):
        self.contexts = {}
        
    async def initialize(self):
        print("âœ… Context manager initialized")
        
    async def shutdown(self):
        print("âœ… Context manager shutdown")
        
    async def store_context(self, workflow_id: str, context: Dict[str, Any]):
        self.contexts[workflow_id] = context
        print(f"âœ… Context stored for workflow: {workflow_id}")
        
    async def get_context(self, workflow_id: str):
        return self.contexts.get(workflow_id)

class MockAgent:
    """Mock agent for testing"""
    
    def __init__(self, name: str, capabilities: List[str]):
        self.name = name
        self.capabilities = capabilities
        self.status = "IDLE"
        self.test_counter = 0
        self.logger = logging.getLogger(f"test_agent.{name}")
        
    async def start(self):
        self.status = "RUNNING"
        self.logger.info(f"{self.name} started in TEST MODE")
        print(f"âœ… {self.name} started")
        
    async def stop(self):
        self.status = "STOPPED"
        self.logger.info(f"{self.name} stopped")
        print(f"âœ… {self.name} stopped")
        
    async def execute_task(self, task_data: Dict[str, Any]):
        self.test_counter += 1
        task_type = task_data.get("type", "unknown")
        topic = task_data.get("topic", "æµ‹è¯•ä¸»é¢˜")
        description = task_data.get("description", "æµ‹è¯•æè¿°")
        
        self.logger.info(f"TEST MODE: {self.name} executing task: {task_type}")
        
        # Simulate processing time
        await asyncio.sleep(0.1)
        
        # Generate test content
        content = self._generate_test_content(task_type, topic, description)
        
        return {
            "success": True,
            "data": {
                "content": content,
                "test_mode": True,
                "agent": self.name,
                "task_type": task_type
            },
            "execution_time": 0.1,
            "metadata": {
                "test_mode": True,
                "agent": self.name,
                "counter": self.test_counter
            }
        }
        
    def _generate_test_content(self, task_type: str, topic: str, description: str) -> str:
        """Generate detailed test content based on agent type and task"""
        
        if "planner" in self.name:
            return f"""# ä¸“åˆ©è§„åˆ’æµ‹è¯•ç»“æœ

## ä¸»é¢˜åˆ†æ
- **ä¸“åˆ©ä¸»é¢˜**: {topic}
- **æŠ€æœ¯æè¿°**: {description}
- **æ–°é¢–æ€§è¯„åˆ†**: 8.5/10
- **åˆ›é€ æ€§è¯„åˆ†**: 7.8/10

## ä¸“åˆ©æ€§è¯„ä¼°
è¯¥æŠ€æœ¯æ–¹æ¡ˆå…·æœ‰è¾ƒé«˜çš„ä¸“åˆ©æ€§ï¼Œä¸»è¦ä½“ç°åœ¨ï¼š
1. æŠ€æœ¯æ–¹æ¡ˆå…·æœ‰æ–°é¢–æ€§
2. ç›¸å¯¹äºç°æœ‰æŠ€æœ¯å…·æœ‰åˆ›é€ æ€§
3. å…·æœ‰å·¥ä¸šå®ç”¨æ€§

## å¼€å‘ç­–ç•¥
### ç¬¬ä¸€é˜¶æ®µï¼šæŠ€æœ¯éªŒè¯ (2-3ä¸ªæœˆ)
- å…³é”®æŠ€æœ¯éªŒè¯
- åŸå‹å¼€å‘
- åˆæ­¥æµ‹è¯•

### ç¬¬äºŒé˜¶æ®µï¼šä¸“åˆ©ç”³è¯·å‡†å¤‡ (1-2ä¸ªæœˆ)
- ä¸“åˆ©æ£€ç´¢
- æŠ€æœ¯æ–‡æ¡£æ•´ç†
- ä¸“åˆ©ç”³è¯·æ–‡ä»¶æ’°å†™

### ç¬¬ä¸‰é˜¶æ®µï¼šä¸“åˆ©ç”³è¯·æäº¤ (1ä¸ªæœˆ)
- ä¸“åˆ©ç”³è¯·æ–‡ä»¶å®Œå–„
- æäº¤ä¸“åˆ©ç”³è¯·
- åç»­è·Ÿè¸ª

## é£é™©è¯„ä¼°
- **æŠ€æœ¯é£é™©**: ä¸­ç­‰
- **å¸‚åœºé£é™©**: ä½
- **æ³•å¾‹é£é™©**: ä½

## èµ„æºéœ€æ±‚
- æŠ€æœ¯ä¸“å®¶: 2-3äºº
- ä¸“åˆ©ä»£ç†äºº: 1äºº
- é¢„ç®—: çº¦50-100ä¸‡å…ƒ

## æˆåŠŸæ¦‚ç‡
åŸºäºå½“å‰æŠ€æœ¯æ°´å¹³å’Œå¸‚åœºæƒ…å†µï¼Œé¢„è®¡æˆåŠŸæ¦‚ç‡ä¸º75%ã€‚

---
*æ­¤ç»“æœç”±æµ‹è¯•æ¨¡å¼ç”Ÿæˆï¼Œä»…ç”¨äºç³»ç»Ÿè°ƒè¯•*"""

        elif "writer" in self.name:
            return f"""# ä¸“åˆ©ç”³è¯·æ–‡ä»¶æµ‹è¯•ç»“æœ

## å‘æ˜åç§°
{topic}

## æŠ€æœ¯é¢†åŸŸ
æœ¬å‘æ˜æ¶‰åŠ{description}æŠ€æœ¯é¢†åŸŸï¼Œå…·ä½“æ¶‰åŠä¸€ç§æ”¹è¿›çš„{description}æ–¹æ³•åŠç³»ç»Ÿã€‚

## èƒŒæ™¯æŠ€æœ¯
ç°æœ‰æŠ€æœ¯ä¸­ï¼Œ{description}å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š
1. æ•ˆç‡ä½ä¸‹
2. æˆæœ¬è¾ƒé«˜
3. ç²¾åº¦ä¸è¶³

## å‘æ˜å†…å®¹
æœ¬å‘æ˜çš„ç›®çš„æ˜¯æä¾›ä¸€ç§æ”¹è¿›çš„{description}æ–¹æ³•ï¼Œè§£å†³ç°æœ‰æŠ€æœ¯ä¸­çš„ä¸Šè¿°é—®é¢˜ã€‚

### æŠ€æœ¯æ–¹æ¡ˆ
æœ¬å‘æ˜é‡‡ç”¨ä»¥ä¸‹æŠ€æœ¯æ–¹æ¡ˆï¼š
1. é‡‡ç”¨æ–°å‹ç®—æ³•ä¼˜åŒ–å¤„ç†æµç¨‹
2. å¼•å…¥æ™ºèƒ½æ§åˆ¶ç³»ç»Ÿ
3. é›†æˆå¤šä¼ æ„Ÿå™¨èåˆæŠ€æœ¯

### æœ‰ç›Šæ•ˆæœ
1. æé«˜å¤„ç†æ•ˆç‡30%ä»¥ä¸Š
2. é™ä½ç”Ÿäº§æˆæœ¬20%
3. æå‡ç²¾åº¦è‡³95%ä»¥ä¸Š

## é™„å›¾è¯´æ˜
å›¾1ä¸ºæœ¬å‘æ˜çš„ç³»ç»Ÿæ¶æ„å›¾
å›¾2ä¸ºæœ¬å‘æ˜çš„æµç¨‹å›¾
å›¾3ä¸ºæœ¬å‘æ˜çš„å®æ–½ä¾‹ç¤ºæ„å›¾

## å…·ä½“å®æ–½æ–¹å¼
### å®æ–½ä¾‹1
æœ¬å®æ–½ä¾‹æä¾›äº†ä¸€ç§{description}ç³»ç»Ÿï¼ŒåŒ…æ‹¬ï¼š
- æ•°æ®é‡‡é›†æ¨¡å—
- å¤„ç†åˆ†ææ¨¡å—
- è¾“å‡ºæ§åˆ¶æ¨¡å—

### å®æ–½ä¾‹2
æœ¬å®æ–½ä¾‹æä¾›äº†ä¸€ç§{description}æ–¹æ³•ï¼ŒåŒ…æ‹¬ä»¥ä¸‹æ­¥éª¤ï¼š
1. æ•°æ®è¾“å…¥
2. é¢„å¤„ç†
3. ç‰¹å¾æå–
4. ç»“æœè¾“å‡º

## æƒåˆ©è¦æ±‚ä¹¦
1. ä¸€ç§{description}æ–¹æ³•ï¼Œå…¶ç‰¹å¾åœ¨äºï¼ŒåŒ…æ‹¬ä»¥ä¸‹æ­¥éª¤ï¼š
   - æ­¥éª¤1ï¼šæ•°æ®é‡‡é›†
   - æ­¥éª¤2ï¼šæ•°æ®å¤„ç†
   - æ­¥éª¤3ï¼šç»“æœè¾“å‡º

2. æ ¹æ®æƒåˆ©è¦æ±‚1æ‰€è¿°çš„æ–¹æ³•ï¼Œå…¶ç‰¹å¾åœ¨äºï¼Œæ‰€è¿°æ•°æ®å¤„ç†æ­¥éª¤åŒ…æ‹¬ç‰¹å¾æå–å’Œæ¨¡å¼è¯†åˆ«ã€‚

---
*æ­¤ç»“æœç”±æµ‹è¯•æ¨¡å¼ç”Ÿæˆï¼Œä»…ç”¨äºç³»ç»Ÿè°ƒè¯•*"""

        elif "searcher" in self.name:
            return f"""# ä¸“åˆ©æ£€ç´¢æµ‹è¯•ç»“æœ

## æ£€ç´¢ä¸»é¢˜
{topic}

## æ£€ç´¢ç­–ç•¥
åŸºäºå…³é”®è¯"{description}"è¿›è¡Œæ£€ç´¢ï¼Œæ¶µç›–ç›¸å…³æŠ€æœ¯é¢†åŸŸã€‚

## æ£€ç´¢ç»“æœ
### ç›¸å…³ä¸“åˆ©æ–‡çŒ® (å…±æ‰¾åˆ°15ç¯‡)

#### 1. ä¸“åˆ©å·ï¼šCN123456789A
- **æ ‡é¢˜**: ä¸€ç§{description}æ–¹æ³•
- **ç”³è¯·äºº**: æµ‹è¯•å…¬å¸A
- **ç”³è¯·æ—¥**: 2023-01-15
- **å…¬å¼€æ—¥**: 2023-07-20
- **æ‘˜è¦**: æœ¬å‘æ˜å…¬å¼€äº†ä¸€ç§{description}æ–¹æ³•ï¼Œé€šè¿‡...

#### 2. ä¸“åˆ©å·ï¼šCN987654321B
- **æ ‡é¢˜**: {description}ç³»ç»ŸåŠè£…ç½®
- **ç”³è¯·äºº**: æµ‹è¯•å…¬å¸B
- **ç”³è¯·æ—¥**: 2022-08-10
- **å…¬å¼€æ—¥**: 2023-02-15
- **æ‘˜è¦**: æœ¬å‘æ˜æ¶‰åŠä¸€ç§{description}ç³»ç»Ÿï¼ŒåŒ…æ‹¬...

#### 3. ä¸“åˆ©å·ï¼šUS20230012345A1
- **æ ‡é¢˜**: Method and System for {description}
- **ç”³è¯·äºº**: Test Company C
- **ç”³è¯·æ—¥**: 2023-03-20
- **å…¬å¼€æ—¥**: 2023-09-25
- **æ‘˜è¦**: A method and system for {description} is disclosed...

## æŠ€æœ¯åˆ†æ
### ç°æœ‰æŠ€æœ¯ç‰¹ç‚¹
1. ä¸»è¦é›†ä¸­åœ¨åŸºç¡€åŠŸèƒ½å®ç°
2. ç¼ºä¹æ™ºèƒ½åŒ–å¤„ç†èƒ½åŠ›
3. æ•ˆç‡æœ‰å¾…æå‡

### æŠ€æœ¯ç©ºç™½ç‚¹
1. æ™ºèƒ½åŒ–{description}å¤„ç†
2. è‡ªé€‚åº”ä¼˜åŒ–ç®—æ³•
3. å¤šæ¨¡æ€æ•°æ®èåˆ

## ç«äº‰æ€åŠ¿åˆ†æ
- **ä¸»è¦ç«äº‰è€…**: æµ‹è¯•å…¬å¸Aã€æµ‹è¯•å…¬å¸Bã€æµ‹è¯•å…¬å¸C
- **æŠ€æœ¯æˆç†Ÿåº¦**: ä¸­ç­‰
- **å¸‚åœºé›†ä¸­åº¦**: åˆ†æ•£

## å»ºè®®
1. é‡ç‚¹å…³æ³¨æ™ºèƒ½åŒ–æŠ€æœ¯æ–¹å‘
2. åŠ å¼ºç®—æ³•ä¼˜åŒ–ç ”ç©¶
3. è€ƒè™‘å¤šæ¨¡æ€èåˆæŠ€æœ¯

---
*æ­¤ç»“æœç”±æµ‹è¯•æ¨¡å¼ç”Ÿæˆï¼Œä»…ç”¨äºç³»ç»Ÿè°ƒè¯•*"""

        elif "reviewer" in self.name:
            return f"""# ä¸“åˆ©å®¡æŸ¥æµ‹è¯•ç»“æœ

## å®¡æŸ¥ä¸»é¢˜
{topic}

## å®¡æŸ¥æ ‡å‡†
åŸºäºä¸“åˆ©æ³•ç›¸å…³è§„å®šè¿›è¡Œå®¡æŸ¥ï¼Œé‡ç‚¹å…³æ³¨æ–°é¢–æ€§ã€åˆ›é€ æ€§å’Œå®ç”¨æ€§ã€‚

## å®¡æŸ¥ç»“æœ

### æ–°é¢–æ€§å®¡æŸ¥
âœ… **é€šè¿‡**
- ç»æ£€ç´¢ï¼Œæœªå‘ç°å®Œå…¨ç›¸åŒçš„ç°æœ‰æŠ€æœ¯
- æŠ€æœ¯æ–¹æ¡ˆå…·æœ‰æ–°é¢–æ€§ç‰¹å¾

### åˆ›é€ æ€§å®¡æŸ¥
âœ… **é€šè¿‡**
- ç›¸å¯¹äºç°æœ‰æŠ€æœ¯å…·æœ‰éæ˜¾è€Œæ˜“è§æ€§
- æŠ€æœ¯æ–¹æ¡ˆå…·æœ‰åˆ›é€ æ€§

### å®ç”¨æ€§å®¡æŸ¥
âœ… **é€šè¿‡**
- æŠ€æœ¯æ–¹æ¡ˆèƒ½å¤Ÿå®ç°
- å…·æœ‰å·¥ä¸šåº”ç”¨ä»·å€¼

## è¯¦ç»†å®¡æŸ¥æ„è§

### ä¼˜ç‚¹
1. æŠ€æœ¯æ–¹æ¡ˆå®Œæ•´ï¼Œé€»è¾‘æ¸…æ™°
2. æƒåˆ©è¦æ±‚ä¹¦æ’°å†™è§„èŒƒ
3. è¯´æ˜ä¹¦æè¿°è¯¦ç»†

### éœ€è¦æ”¹è¿›çš„åœ°æ–¹
1. éƒ¨åˆ†æŠ€æœ¯æœ¯è¯­éœ€è¦è¿›ä¸€æ­¥æ˜ç¡®
2. å®æ–½ä¾‹å¯ä»¥æ›´åŠ å…·ä½“
3. é™„å›¾è¯´æ˜å¯ä»¥æ›´åŠ è¯¦ç»†

### å»ºè®®ä¿®æ”¹
1. åœ¨ç¬¬Xæ¡æƒåˆ©è¦æ±‚ä¸­æ˜ç¡®"..."çš„å«ä¹‰
2. åœ¨å®æ–½ä¾‹ä¸­å¢åŠ å…·ä½“çš„æŠ€æœ¯å‚æ•°
3. è¡¥å……é™„å›¾è¯´æ˜çš„è¯¦ç»†æè¿°

## æ€»ä½“è¯„ä»·
- **æ–°é¢–æ€§è¯„åˆ†**: 9/10
- **åˆ›é€ æ€§è¯„åˆ†**: 8/10
- **å®ç”¨æ€§è¯„åˆ†**: 9/10
- **æ€»ä½“è¯„åˆ†**: 8.7/10

## å®¡æŸ¥ç»“è®º
è¯¥ä¸“åˆ©ç”³è¯·åŸºæœ¬ç¬¦åˆä¸“åˆ©æ³•è¦æ±‚ï¼Œå»ºè®®åœ¨ä¿®æ”¹åäºˆä»¥æˆæƒã€‚

---
*æ­¤ç»“æœç”±æµ‹è¯•æ¨¡å¼ç”Ÿæˆï¼Œä»…ç”¨äºç³»ç»Ÿè°ƒè¯•*"""

        elif "rewriter" in self.name:
            return f"""# ä¸“åˆ©é‡å†™æµ‹è¯•ç»“æœ

## é‡å†™ä¸»é¢˜
{topic}

## é‡å†™ç­–ç•¥
åŸºäºå®¡æŸ¥æ„è§å’Œæœ€ä½³å®è·µï¼Œå¯¹ä¸“åˆ©ç”³è¯·æ–‡ä»¶è¿›è¡Œä¼˜åŒ–é‡å†™ã€‚

## é‡å†™åçš„ä¸“åˆ©ç”³è¯·æ–‡ä»¶

### å‘æ˜åç§°
ä¸€ç§æ”¹è¿›çš„{description}æ–¹æ³•åŠç³»ç»Ÿ

### æŠ€æœ¯é¢†åŸŸ
æœ¬å‘æ˜æ¶‰åŠ{description}æŠ€æœ¯é¢†åŸŸï¼Œå…·ä½“æ¶‰åŠä¸€ç§åŸºäºäººå·¥æ™ºèƒ½çš„{description}æ–¹æ³•åŠç³»ç»Ÿã€‚

### èƒŒæ™¯æŠ€æœ¯
ç°æœ‰æŠ€æœ¯ä¸­ï¼Œ{description}å­˜åœ¨ä»¥ä¸‹æŠ€æœ¯é—®é¢˜ï¼š
1. å¤„ç†æ•ˆç‡ä½ä¸‹ï¼Œæ— æ³•æ»¡è¶³å¤§è§„æ¨¡åº”ç”¨éœ€æ±‚
2. ç²¾åº¦ä¸è¶³ï¼Œå½±å“å®é™…åº”ç”¨æ•ˆæœ
3. æˆæœ¬è¾ƒé«˜ï¼Œé™åˆ¶äº†æ¨å¹¿åº”ç”¨

### å‘æ˜å†…å®¹
æœ¬å‘æ˜çš„ç›®çš„æ˜¯æä¾›ä¸€ç§æ”¹è¿›çš„{description}æ–¹æ³•åŠç³»ç»Ÿï¼Œè§£å†³ç°æœ‰æŠ€æœ¯ä¸­çš„ä¸Šè¿°é—®é¢˜ã€‚

#### æŠ€æœ¯æ–¹æ¡ˆ
æœ¬å‘æ˜é‡‡ç”¨ä»¥ä¸‹æŠ€æœ¯æ–¹æ¡ˆï¼š
1. å¼•å…¥æ·±åº¦å­¦ä¹ ç®—æ³•ï¼Œæå‡å¤„ç†ç²¾åº¦
2. é‡‡ç”¨å¹¶è¡Œè®¡ç®—æ¶æ„ï¼Œæé«˜å¤„ç†æ•ˆç‡
3. é›†æˆè‡ªé€‚åº”ä¼˜åŒ–æœºåˆ¶ï¼Œé™ä½ç³»ç»Ÿæˆæœ¬

#### æœ‰ç›Šæ•ˆæœ
1. å¤„ç†æ•ˆç‡æå‡50%ä»¥ä¸Š
2. ç²¾åº¦æå‡è‡³98%ä»¥ä¸Š
3. æˆæœ¬é™ä½30%ä»¥ä¸Š

### æƒåˆ©è¦æ±‚ä¹¦ï¼ˆä¼˜åŒ–ç‰ˆï¼‰
1. ä¸€ç§{description}æ–¹æ³•ï¼Œå…¶ç‰¹å¾åœ¨äºï¼ŒåŒ…æ‹¬ä»¥ä¸‹æ­¥éª¤ï¼š
   S1ï¼šæ•°æ®è¾“å…¥ï¼Œæ¥æ”¶å¾…å¤„ç†çš„{description}æ•°æ®ï¼›
   S2ï¼šé¢„å¤„ç†ï¼Œå¯¹è¾“å…¥æ•°æ®è¿›è¡Œæ ‡å‡†åŒ–å¤„ç†ï¼›
   S3ï¼šç‰¹å¾æå–ï¼Œé‡‡ç”¨æ·±åº¦å­¦ä¹ ç®—æ³•æå–å…³é”®ç‰¹å¾ï¼›
   S4ï¼šç»“æœè¾“å‡ºï¼Œè¾“å‡ºå¤„ç†ç»“æœã€‚

2. æ ¹æ®æƒåˆ©è¦æ±‚1æ‰€è¿°çš„æ–¹æ³•ï¼Œå…¶ç‰¹å¾åœ¨äºï¼Œæ‰€è¿°S3æ­¥éª¤ä¸­çš„æ·±åº¦å­¦ä¹ ç®—æ³•ä¸ºå·ç§¯ç¥ç»ç½‘ç»œã€‚

3. æ ¹æ®æƒåˆ©è¦æ±‚1æ‰€è¿°çš„æ–¹æ³•ï¼Œå…¶ç‰¹å¾åœ¨äºï¼Œè¿˜åŒ…æ‹¬è‡ªé€‚åº”ä¼˜åŒ–æ­¥éª¤ï¼Œæ ¹æ®å¤„ç†ç»“æœåŠ¨æ€è°ƒæ•´ç®—æ³•å‚æ•°ã€‚

### è¯´æ˜ä¹¦é™„å›¾
å›¾1ä¸ºæœ¬å‘æ˜çš„ç³»ç»Ÿæ¶æ„å›¾
å›¾2ä¸ºæœ¬å‘æ˜çš„ç®—æ³•æµç¨‹å›¾
å›¾3ä¸ºæœ¬å‘æ˜çš„å®æ–½ä¾‹ç¤ºæ„å›¾

## é‡å†™æ”¹è¿›ç‚¹
1. **æŠ€æœ¯æ–¹æ¡ˆæ›´åŠ å…·ä½“**: æ˜ç¡®äº†æ·±åº¦å­¦ä¹ ç®—æ³•çš„åº”ç”¨
2. **æƒåˆ©è¦æ±‚æ›´åŠ æ¸…æ™°**: å¢åŠ äº†å…·ä½“çš„æŠ€æœ¯ç‰¹å¾
3. **å®æ–½ä¾‹æ›´åŠ è¯¦ç»†**: è¡¥å……äº†å…·ä½“çš„æŠ€æœ¯å‚æ•°
4. **é€»è¾‘ç»“æ„æ›´åŠ åˆç†**: ä¼˜åŒ–äº†æ•´ä½“æ–‡æ¡£ç»“æ„

## è´¨é‡è¯„ä¼°
- **æŠ€æœ¯å®Œæ•´æ€§**: 9/10
- **æ³•å¾‹è§„èŒƒæ€§**: 9/10
- **å¯è¯»æ€§**: 8/10
- **æ€»ä½“è´¨é‡**: 8.7/10

---
*æ­¤ç»“æœç”±æµ‹è¯•æ¨¡å¼ç”Ÿæˆï¼Œä»…ç”¨äºç³»ç»Ÿè°ƒè¯•*"""

        elif "discusser" in self.name:
            return f"""# ä¸“åˆ©è®¨è®ºæµ‹è¯•ç»“æœ

## è®¨è®ºä¸»é¢˜
{topic}

## è®¨è®ºç„¦ç‚¹
åŸºäº{description}æŠ€æœ¯ï¼Œæ¢è®¨æŠ€æœ¯å‘å±•æ–¹å‘å’Œä¸“åˆ©ç”³è¯·ç­–ç•¥ã€‚

## æŠ€æœ¯è®¨è®º

### æŠ€æœ¯å‘å±•è¶‹åŠ¿
1. **æ™ºèƒ½åŒ–æ–¹å‘**: {description}æŠ€æœ¯æ­£æœç€æ™ºèƒ½åŒ–æ–¹å‘å‘å±•
2. **é›†æˆåŒ–è¶‹åŠ¿**: å¤šæŠ€æœ¯èåˆæˆä¸ºä¸»æµ
3. **æ ‡å‡†åŒ–éœ€æ±‚**: è¡Œä¸šæ ‡å‡†åˆ¶å®šæ—¥ç›Šé‡è¦

### æŠ€æœ¯æŒ‘æˆ˜
1. **ç®—æ³•ä¼˜åŒ–**: éœ€è¦æ›´é«˜æ•ˆçš„ç®—æ³•
2. **æ•°æ®è´¨é‡**: é«˜è´¨é‡æ•°æ®è·å–å›°éš¾
3. **å®æ—¶æ€§è¦æ±‚**: éœ€è¦æ»¡è¶³å®æ—¶å¤„ç†éœ€æ±‚

### æŠ€æœ¯æœºé‡
1. **AIæŠ€æœ¯èåˆ**: äººå·¥æ™ºèƒ½æŠ€æœ¯å¸¦æ¥æ–°æœºé‡
2. **è¾¹ç¼˜è®¡ç®—**: è¾¹ç¼˜è®¡ç®—æŠ€æœ¯æä¾›æ–°æ€è·¯
3. **5GæŠ€æœ¯**: 5Gç½‘ç»œä¸º{description}æä¾›æ–°å¯èƒ½

## ä¸“åˆ©ç”³è¯·ç­–ç•¥è®¨è®º

### æ ¸å¿ƒä¸“åˆ©å¸ƒå±€
1. **åŸºç¡€ä¸“åˆ©**: ä¿æŠ¤æ ¸å¿ƒæŠ€æœ¯æ–¹æ¡ˆ
2. **åº”ç”¨ä¸“åˆ©**: ä¿æŠ¤å…·ä½“åº”ç”¨åœºæ™¯
3. **æ”¹è¿›ä¸“åˆ©**: ä¿æŠ¤æŠ€æœ¯æ”¹è¿›æ–¹æ¡ˆ

### ä¸“åˆ©ç»„åˆç­–ç•¥
1. **æŠ€æœ¯è¦†ç›–**: å…¨é¢è¦†ç›–æŠ€æœ¯é¢†åŸŸ
2. **åœ°åŸŸå¸ƒå±€**: é‡ç‚¹å¸‚åœºä¸“åˆ©å¸ƒå±€
3. **æ—¶é—´å¸ƒå±€**: åˆ†é˜¶æ®µç”³è¯·ç­–ç•¥

### é£é™©è§„é¿
1. **ä¸“åˆ©æ£€ç´¢**: å……åˆ†è¿›è¡Œä¸“åˆ©æ£€ç´¢
2. **æŠ€æœ¯è§„é¿**: è®¾è®¡è§„é¿æ–¹æ¡ˆ
3. **æ³•å¾‹å’¨è¯¢**: å¯»æ±‚ä¸“ä¸šæ³•å¾‹æ„è§

## å›¢é˜Ÿè®¨è®ºè¦ç‚¹

### æŠ€æœ¯å›¢é˜Ÿè§‚ç‚¹
- æŠ€æœ¯æ–¹æ¡ˆå…·æœ‰åˆ›æ–°æ€§
- å®ç°éš¾åº¦é€‚ä¸­
- å¸‚åœºå‰æ™¯è‰¯å¥½

### æ³•å¾‹å›¢é˜Ÿè§‚ç‚¹
- ä¸“åˆ©ç”³è¯·ç­–ç•¥åˆç†
- æƒåˆ©è¦æ±‚æ’°å†™è§„èŒƒ
- é£é™©æ§åˆ¶æªæ–½åˆ°ä½

### å¸‚åœºå›¢é˜Ÿè§‚ç‚¹
- å¸‚åœºéœ€æ±‚æ—ºç››
- ç«äº‰ä¼˜åŠ¿æ˜æ˜¾
- å•†ä¸šåŒ–å‰æ™¯å¹¿é˜”

## è®¨è®ºç»“è®º
1. **æŠ€æœ¯æ–¹å‘**: ç»§ç»­æ¨è¿›æ™ºèƒ½åŒ–æŠ€æœ¯ç ”å‘
2. **ä¸“åˆ©ç”³è¯·**: åŠ å¿«ä¸“åˆ©ç”³è¯·è¿›åº¦
3. **é£é™©æ§åˆ¶**: åŠ å¼ºä¸“åˆ©é£é™©é˜²èŒƒ
4. **å›¢é˜Ÿåä½œ**: åŠ å¼ºè·¨å›¢é˜Ÿåä½œ

---
*æ­¤ç»“æœç”±æµ‹è¯•æ¨¡å¼ç”Ÿæˆï¼Œä»…ç”¨äºç³»ç»Ÿè°ƒè¯•*"""

        elif "coordinator" in self.name:
            return f"""# å·¥ä½œæµåè°ƒæµ‹è¯•ç»“æœ

## åè°ƒä¸»é¢˜
{topic} ä¸“åˆ©å¼€å‘å·¥ä½œæµ

## å·¥ä½œæµçŠ¶æ€
âœ… **å·¥ä½œæµå·²å¯åŠ¨**
ğŸ”„ **æ­£åœ¨åè°ƒå„æ™ºèƒ½ä½“**

## ä»»åŠ¡åˆ†é…çŠ¶æ€

### 1. è§„åˆ’é˜¶æ®µ (Planner Agent)
- **çŠ¶æ€**: âœ… å·²å®Œæˆ
- **ä»»åŠ¡**: ä¸“åˆ©è§„åˆ’ç­–ç•¥åˆ¶å®š
- **ç»“æœ**: ç”Ÿæˆå®Œæ•´çš„å¼€å‘ç­–ç•¥

### 2. æ£€ç´¢é˜¶æ®µ (Searcher Agent)
- **çŠ¶æ€**: âœ… å·²å®Œæˆ
- **ä»»åŠ¡**: ä¸“åˆ©æ£€ç´¢åˆ†æ
- **ç»“æœ**: å®Œæˆç›¸å…³ä¸“åˆ©æ£€ç´¢

### 3. æ’°å†™é˜¶æ®µ (Writer Agent)
- **çŠ¶æ€**: ğŸ”„ è¿›è¡Œä¸­
- **ä»»åŠ¡**: ä¸“åˆ©ç”³è¯·æ–‡ä»¶æ’°å†™
- **è¿›åº¦**: 60%

### 4. å®¡æŸ¥é˜¶æ®µ (Reviewer Agent)
- **çŠ¶æ€**: â³ ç­‰å¾…ä¸­
- **ä»»åŠ¡**: ä¸“åˆ©ç”³è¯·æ–‡ä»¶å®¡æŸ¥
- **ä¾èµ–**: ç­‰å¾…Writer Agentå®Œæˆ

### 5. é‡å†™é˜¶æ®µ (Rewriter Agent)
- **çŠ¶æ€**: â³ ç­‰å¾…ä¸­
- **ä»»åŠ¡**: æ ¹æ®å®¡æŸ¥æ„è§é‡å†™
- **ä¾èµ–**: ç­‰å¾…Reviewer Agentå®Œæˆ

### 6. è®¨è®ºé˜¶æ®µ (Discusser Agent)
- **çŠ¶æ€**: â³ ç­‰å¾…ä¸­
- **ä»»åŠ¡**: æŠ€æœ¯è®¨è®ºå’Œä¼˜åŒ–
- **ä¾èµ–**: ç­‰å¾…Rewriter Agentå®Œæˆ

## åè°ƒç­–ç•¥
1. **å¹¶è¡Œå¤„ç†**: åœ¨å¯èƒ½çš„æƒ…å†µä¸‹å¹¶è¡Œæ‰§è¡Œä»»åŠ¡
2. **ä¾èµ–ç®¡ç†**: ç¡®ä¿ä»»åŠ¡ä¾èµ–å…³ç³»æ­£ç¡®
3. **è´¨é‡æ§åˆ¶**: æ¯ä¸ªé˜¶æ®µéƒ½è¿›è¡Œè´¨é‡æ£€æŸ¥
4. **è¿›åº¦ç›‘æ§**: å®æ—¶ç›‘æ§å·¥ä½œæµè¿›åº¦

## ä¸‹ä¸€æ­¥è®¡åˆ’
1. ç­‰å¾…Writer Agentå®Œæˆä¸“åˆ©ç”³è¯·æ–‡ä»¶æ’°å†™
2. å¯åŠ¨Reviewer Agentè¿›è¡Œæ–‡ä»¶å®¡æŸ¥
3. æ ¹æ®å®¡æŸ¥ç»“æœå†³å®šæ˜¯å¦éœ€è¦é‡å†™
4. æœ€ç»ˆå®Œæˆä¸“åˆ©ç”³è¯·æ–‡ä»¶

## é¢„è®¡å®Œæˆæ—¶é—´
- **å½“å‰é˜¶æ®µ**: æ’°å†™é˜¶æ®µ
- **é¢„è®¡å®Œæˆ**: 2-3å°æ—¶å
- **æ€»ä½“è¿›åº¦**: 40%

---
*æ­¤ç»“æœç”±æµ‹è¯•æ¨¡å¼ç”Ÿæˆï¼Œä»…ç”¨äºç³»ç»Ÿè°ƒè¯•*"""

        else:
            return f"# {self.name} æµ‹è¯•ç»“æœ\n\n## ä»»åŠ¡ç±»å‹: {task_type}\n## ä¸»é¢˜: {topic}\n## æè¿°: {description}\n\n## æµ‹è¯•å†…å®¹\nè¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ¨¡å¼ç”Ÿæˆçš„å†…å®¹ï¼Œç”¨äºéªŒè¯æ™ºèƒ½ä½“åŠŸèƒ½ã€‚"
        
    async def get_status(self):
        return {
            "name": self.name,
            "status": self.status,
            "capabilities": self.capabilities,
            "test_mode": True
        }

class MockPatentAgentSystem:
    """Mock patent agent system for testing"""
    
    def __init__(self):
        self.agents = {}
        self.workflow_id = None
        self.message_bus = MockMessageBus()
        self.context_manager = MockContextManager()
        self.logger = logging.getLogger("test_system")
        
    async def start(self):
        """Start the test system"""
        try:
            self.logger.info("Starting Patent Agent System in TEST MODE")
            
            # Initialize components
            await self.context_manager.initialize()
            
            # Create mock agents
            agent_configs = [
                ("planner_agent", ["patent_planning", "strategy_development"]),
                ("writer_agent", ["patent_drafting", "technical_writing"]),
                ("searcher_agent", ["patent_search", "prior_art_analysis"]),
                ("reviewer_agent", ["patent_review", "quality_assessment"]),
                ("rewriter_agent", ["patent_rewriting", "content_optimization"]),
                ("discusser_agent", ["patent_discussion", "collaborative_analysis"]),
                ("coordinator_agent", ["workflow_coordination", "task_scheduling"])
            ]
            
            for name, capabilities in agent_configs:
                self.agents[name] = MockAgent(name, capabilities)
                await self.agents[name].start()
                
            self.logger.info("All test agents started successfully")
            
        except Exception as e:
            self.logger.error(f"Error starting test system: {e}")
            raise
            
    async def stop(self):
        """Stop the test system"""
        try:
            self.logger.info("Stopping Patent Agent System Test Mode")
            
            # Stop all agents
            for name, agent in self.agents.items():
                await agent.stop()
                
            # Shutdown components
            await self.context_manager.shutdown()
            
            self.logger.info("Patent Agent System Test Mode stopped successfully")
            
        except Exception as e:
            self.logger.error(f"Error stopping test system: {e}")
            
    async def run_detailed_test(self, topic: str, description: str) -> Dict[str, Any]:
        """Run detailed test showing content from each agent"""
        try:
            self.logger.info("Running detailed test...")
            
            test_results = {}
            
            # Test each agent individually
            test_tasks = {
                "planner_agent": {
                    "type": "patent_planning",
                    "topic": topic,
                    "description": description
                },
                "searcher_agent": {
                    "type": "patent_search",
                    "topic": topic,
                    "description": description
                },
                "writer_agent": {
                    "type": "patent_drafting",
                    "topic": topic,
                    "description": description
                },
                "reviewer_agent": {
                    "type": "patent_review",
                    "topic": topic,
                    "description": description
                },
                "rewriter_agent": {
                    "type": "patent_rewriting",
                    "topic": topic,
                    "description": description
                },
                "discusser_agent": {
                    "type": "patent_discussion",
                    "topic": topic,
                    "description": description
                },
                "coordinator_agent": {
                    "type": "workflow_coordination",
                    "topic": topic,
                    "description": description
                }
            }
            
            for agent_name, task_data in test_tasks.items():
                self.logger.info(f"Testing {agent_name}...")
                agent = self.agents[agent_name]
                result = await agent.execute_task(task_data)
                test_results[agent_name] = {
                    "success": result["success"],
                    "execution_time": result["execution_time"],
                    "content": result["data"].get("content", ""),
                    "test_mode": True
                }
                self.logger.info(f"{agent_name} test completed: {result['success']}")
                
            return {
                "success": True,
                "test_results": test_results,
                "test_mode": True,
                "timestamp": time.time()
            }
            
        except Exception as e:
            self.logger.error(f"Error in detailed test: {e}")
            return {
                "success": False,
                "error": str(e),
                "test_mode": True
            }

async def detailed_test():
    """Run a detailed test showing content from each agent"""
    print("ğŸ§ª Starting Patent Agent Detailed Test Mode")
    print("=" * 60)
    
    # Test parameters
    topic = "æ™ºèƒ½å›¾åƒè¯†åˆ«ç³»ç»Ÿ"
    description = "ä¸€ç§åŸºäºæ·±åº¦å­¦ä¹ çš„æ™ºèƒ½å›¾åƒè¯†åˆ«ç³»ç»Ÿï¼Œèƒ½å¤Ÿè‡ªåŠ¨è¯†åˆ«å’Œåˆ†ç±»å›¾åƒä¸­çš„ç‰©ä½“"
    
    print(f"ğŸ“ Test Topic: {topic}")
    print(f"ğŸ“„ Test Description: {description}")
    print()
    
    try:
        # Initialize test system
        print("ğŸš€ Initializing test system...")
        system = MockPatentAgentSystem()
        await system.start()
        print("âœ… Test system initialized successfully")
        print()
        
        # Run detailed test
        print("ğŸ§ª Running detailed agent test...")
        result = await system.run_detailed_test(topic, description)
        
        if result["success"]:
            print("âœ… Detailed test completed successfully!")
            print()
            
            # Display results with content
            print("ğŸ“Š Detailed Test Results:")
            print("=" * 60)
            
            for agent_name, agent_result in result["test_results"].items():
                status = "âœ… PASS" if agent_result["success"] else "âŒ FAIL"
                time = f"{agent_result['execution_time']:.2f}s"
                
                print(f"\nğŸ” {agent_name.upper()} ({status}) - {time}")
                print("-" * 40)
                print(agent_result["content"])
                print("-" * 40)
            
            print()
            
            # Summary
            total_agents = len(result["test_results"])
            successful_agents = sum(1 for r in result["test_results"].values() if r["success"])
            total_time = sum(r["execution_time"] for r in result["test_results"].values())
            
            print("ğŸ“ˆ Summary:")
            print(f"   â€¢ Total agents tested: {total_agents}")
            print(f"   â€¢ Successful: {successful_agents}/{total_agents}")
            print(f"   â€¢ Total execution time: {total_time:.2f}s")
            print(f"   â€¢ Average time per agent: {total_time/total_agents:.2f}s")
            
            if successful_agents == total_agents:
                print("\nğŸ‰ All agents passed the test!")
            else:
                print(f"\nâš ï¸  {total_agents - successful_agents} agents failed the test")
                
        else:
            print(f"âŒ Detailed test failed: {result.get('error', 'Unknown error')}")
            
    except Exception as e:
        print(f"âŒ Error during test: {e}")
        import traceback
        traceback.print_exc()
        
    finally:
        # Shutdown system
        print("\nğŸ›‘ Shutting down test system...")
        try:
            await system.stop()
            print("âœ… Test system shutdown complete")
        except Exception as e:
            print(f"âš ï¸  Error during shutdown: {e}")
    
    print("\n" + "=" * 60)
    print("ğŸ Detailed test completed")

def main():
    """Main function"""
    import argparse
    
    parser = argparse.ArgumentParser(description="Patent Agent Detailed Test Mode")
    parser.add_argument("--verbose", "-v", action="store_true", help="Verbose output")
    
    args = parser.parse_args()
    
    if args.verbose:
        logging.getLogger().setLevel(logging.DEBUG)
    
    asyncio.run(detailed_test())

if __name__ == "__main__":
    main()