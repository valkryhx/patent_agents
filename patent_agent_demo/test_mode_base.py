"""
Test Mode Base Class
Provides test mode functionality for all patent development agents
"""

import asyncio
import logging
import time
import uuid
from typing import Dict, Any, Optional, List
from dataclasses import dataclass
from enum import Enum

logger = logging.getLogger(__name__)

@dataclass
class TestModeResponse:
    """Test mode response structure"""
    success: bool
    content: str
    metadata: Optional[Dict[str, Any]] = None
    execution_time: float = 0.0

class TestModeBase:
    """Base class for test mode functionality"""
    
    def __init__(self, agent_name: str):
        self.agent_name = agent_name
        self.test_counter = 0
        self.logger = logging.getLogger(f"test_mode.{agent_name}")
        
    def get_test_response(self, task_type: str, task_data: Dict[str, Any]) -> TestModeResponse:
        """Generate a test response based on task type"""
        self.test_counter += 1
        start_time = time.time()
        
        try:
            # Generate test content based on task type
            content = self._generate_test_content(task_type, task_data)
            
            # Simulate processing time
            time.sleep(0.1)
            
            execution_time = time.time() - start_time
            
            self.logger.info(f"Test mode response generated for {task_type} (counter: {self.test_counter})")
            
            return TestModeResponse(
                success=True,
                content=content,
                metadata={
                    "test_mode": True,
                    "agent": self.agent_name,
                    "task_type": task_type,
                    "counter": self.test_counter,
                    "timestamp": time.time()
                },
                execution_time=execution_time
            )
            
        except Exception as e:
            self.logger.error(f"Error in test mode: {e}")
            return TestModeResponse(
                success=False,
                content=f"Test mode error: {str(e)}",
                metadata={"test_mode": True, "agent": self.agent_name, "error": str(e)},
                execution_time=time.time() - start_time
            )
    
    def _generate_test_content(self, task_type: str, task_data: Dict[str, Any]) -> str:
        """Generate test content based on task type - to be overridden by subclasses"""
        topic = task_data.get("topic", "æµ‹è¯•ä¸»é¢˜")
        description = task_data.get("description", "æµ‹è¯•æè¿°")
        
        return f"[æµ‹è¯•æ¨¡å¼] {self.agent_name} å¤„ç†ä»»åŠ¡ç±»åž‹: {task_type}\nä¸»é¢˜: {topic}\næè¿°: {description}\nè®¡æ•°å™¨: {self.test_counter}"

class PlannerTestMode(TestModeBase):
    """Test mode for Planner Agent"""
    
    def __init__(self):
        super().__init__("planner_agent")
        
    def _generate_test_content(self, task_type: str, task_data: Dict[str, Any]) -> str:
        topic = task_data.get("topic", "æµ‹è¯•ä¸“åˆ©ä¸»é¢˜")
        description = task_data.get("description", "æµ‹è¯•ä¸“åˆ©æè¿°")
        
        if task_type == "patent_planning":
            return f"""# ä¸“åˆ©è§„åˆ’æµ‹è¯•ç»“æžœ

## ä¸»é¢˜åˆ†æž
- **ä¸“åˆ©ä¸»é¢˜**: {topic}
- **æŠ€æœ¯æè¿°**: {description}
- **æ–°é¢–æ€§è¯„åˆ†**: 8.5/10
- **åˆ›é€ æ€§è¯„åˆ†**: 7.8/10

## ä¸“åˆ©æ€§è¯„ä¼°
è¯¥æŠ€æœ¯æ–¹æ¡ˆå…·æœ‰è¾ƒé«˜çš„ä¸“åˆ©æ€§ï¼Œä¸»è¦ä½“çŽ°åœ¨ï¼š
1. æŠ€æœ¯æ–¹æ¡ˆå…·æœ‰æ–°é¢–æ€§
2. ç›¸å¯¹äºŽçŽ°æœ‰æŠ€æœ¯å…·æœ‰åˆ›é€ æ€§
3. å…·æœ‰å·¥ä¸šå®žç”¨æ€§

## å¼€å‘ç­–ç•¥
### ç¬¬ä¸€é˜¶æ®µï¼šæŠ€æœ¯éªŒè¯ (2-3ä¸ªæœˆ)
- å…³é”®æŠ€æœ¯éªŒè¯
- åŽŸåž‹å¼€å‘
- åˆæ­¥æµ‹è¯•

### ç¬¬äºŒé˜¶æ®µï¼šä¸“åˆ©ç”³è¯·å‡†å¤‡ (1-2ä¸ªæœˆ)
- ä¸“åˆ©æ£€ç´¢
- æŠ€æœ¯æ–‡æ¡£æ•´ç†
- ä¸“åˆ©ç”³è¯·æ–‡ä»¶æ’°å†™

### ç¬¬ä¸‰é˜¶æ®µï¼šä¸“åˆ©ç”³è¯·æäº¤ (1ä¸ªæœˆ)
- ä¸“åˆ©ç”³è¯·æ–‡ä»¶å®Œå–„
- æäº¤ä¸“åˆ©ç”³è¯·
- åŽç»­è·Ÿè¸ª

## é£Žé™©è¯„ä¼°
- **æŠ€æœ¯é£Žé™©**: ä¸­ç­‰
- **å¸‚åœºé£Žé™©**: ä½Ž
- **æ³•å¾‹é£Žé™©**: ä½Ž

## èµ„æºéœ€æ±‚
- æŠ€æœ¯ä¸“å®¶: 2-3äºº
- ä¸“åˆ©ä»£ç†äºº: 1äºº
- é¢„ç®—: çº¦50-100ä¸‡å…ƒ

## æˆåŠŸæ¦‚çŽ‡
åŸºäºŽå½“å‰æŠ€æœ¯æ°´å¹³å’Œå¸‚åœºæƒ…å†µï¼Œé¢„è®¡æˆåŠŸæ¦‚çŽ‡ä¸º75%ã€‚

---
*æ­¤ç»“æžœç”±æµ‹è¯•æ¨¡å¼ç”Ÿæˆï¼Œä»…ç”¨äºŽç³»ç»Ÿè°ƒè¯•*"""

class WriterTestMode(TestModeBase):
    """Test mode for Writer Agent"""
    
    def __init__(self):
        super().__init__("writer_agent")
        
    def _generate_test_content(self, task_type: str, task_data: Dict[str, Any]) -> str:
        topic = task_data.get("topic", "æµ‹è¯•ä¸“åˆ©ä¸»é¢˜")
        description = task_data.get("description", "æµ‹è¯•ä¸“åˆ©æè¿°")
        
        if task_type == "patent_drafting":
            return f"""# ä¸“åˆ©ç”³è¯·æ–‡ä»¶æµ‹è¯•ç»“æžœ

## å‘æ˜Žåç§°
{topic}

## æŠ€æœ¯é¢†åŸŸ
æœ¬å‘æ˜Žæ¶‰åŠ{description}æŠ€æœ¯é¢†åŸŸï¼Œå…·ä½“æ¶‰åŠä¸€ç§æ”¹è¿›çš„{description}æ–¹æ³•åŠç³»ç»Ÿã€‚

## èƒŒæ™¯æŠ€æœ¯
çŽ°æœ‰æŠ€æœ¯ä¸­ï¼Œ{description}å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š
1. æ•ˆçŽ‡ä½Žä¸‹
2. æˆæœ¬è¾ƒé«˜
3. ç²¾åº¦ä¸è¶³

## å‘æ˜Žå†…å®¹
æœ¬å‘æ˜Žçš„ç›®çš„æ˜¯æä¾›ä¸€ç§æ”¹è¿›çš„{description}æ–¹æ³•ï¼Œè§£å†³çŽ°æœ‰æŠ€æœ¯ä¸­çš„ä¸Šè¿°é—®é¢˜ã€‚

### æŠ€æœ¯æ–¹æ¡ˆ
æœ¬å‘æ˜Žé‡‡ç”¨ä»¥ä¸‹æŠ€æœ¯æ–¹æ¡ˆï¼š
1. é‡‡ç”¨æ–°åž‹ç®—æ³•ä¼˜åŒ–å¤„ç†æµç¨‹
2. å¼•å…¥æ™ºèƒ½æŽ§åˆ¶ç³»ç»Ÿ
3. é›†æˆå¤šä¼ æ„Ÿå™¨èžåˆæŠ€æœ¯

### æœ‰ç›Šæ•ˆæžœ
1. æé«˜å¤„ç†æ•ˆçŽ‡30%ä»¥ä¸Š
2. é™ä½Žç”Ÿäº§æˆæœ¬20%
3. æå‡ç²¾åº¦è‡³95%ä»¥ä¸Š

## é™„å›¾è¯´æ˜Ž
å›¾1ä¸ºæœ¬å‘æ˜Žçš„ç³»ç»Ÿæž¶æž„å›¾
å›¾2ä¸ºæœ¬å‘æ˜Žçš„æµç¨‹å›¾
å›¾3ä¸ºæœ¬å‘æ˜Žçš„å®žæ–½ä¾‹ç¤ºæ„å›¾

## å…·ä½“å®žæ–½æ–¹å¼
### å®žæ–½ä¾‹1
æœ¬å®žæ–½ä¾‹æä¾›äº†ä¸€ç§{description}ç³»ç»Ÿï¼ŒåŒ…æ‹¬ï¼š
- æ•°æ®é‡‡é›†æ¨¡å—
- å¤„ç†åˆ†æžæ¨¡å—
- è¾“å‡ºæŽ§åˆ¶æ¨¡å—

### å®žæ–½ä¾‹2
æœ¬å®žæ–½ä¾‹æä¾›äº†ä¸€ç§{description}æ–¹æ³•ï¼ŒåŒ…æ‹¬ä»¥ä¸‹æ­¥éª¤ï¼š
1. æ•°æ®è¾“å…¥
2. é¢„å¤„ç†
3. ç‰¹å¾æå–
4. ç»“æžœè¾“å‡º

## æƒåˆ©è¦æ±‚ä¹¦
1. ä¸€ç§{description}æ–¹æ³•ï¼Œå…¶ç‰¹å¾åœ¨äºŽï¼ŒåŒ…æ‹¬ä»¥ä¸‹æ­¥éª¤ï¼š
   - æ­¥éª¤1ï¼šæ•°æ®é‡‡é›†
   - æ­¥éª¤2ï¼šæ•°æ®å¤„ç†
   - æ­¥éª¤3ï¼šç»“æžœè¾“å‡º

2. æ ¹æ®æƒåˆ©è¦æ±‚1æ‰€è¿°çš„æ–¹æ³•ï¼Œå…¶ç‰¹å¾åœ¨äºŽï¼Œæ‰€è¿°æ•°æ®å¤„ç†æ­¥éª¤åŒ…æ‹¬ç‰¹å¾æå–å’Œæ¨¡å¼è¯†åˆ«ã€‚

---
*æ­¤ç»“æžœç”±æµ‹è¯•æ¨¡å¼ç”Ÿæˆï¼Œä»…ç”¨äºŽç³»ç»Ÿè°ƒè¯•*"""

class SearcherTestMode(TestModeBase):
    """Test mode for Searcher Agent"""
    
    def __init__(self):
        super().__init__("searcher_agent")
        
    def _generate_test_content(self, task_type: str, task_data: Dict[str, Any]) -> str:
        topic = task_data.get("topic", "æµ‹è¯•ä¸“åˆ©ä¸»é¢˜")
        description = task_data.get("description", "æµ‹è¯•ä¸“åˆ©æè¿°")
        
        if task_type == "patent_search":
            return f"""# ä¸“åˆ©æ£€ç´¢æµ‹è¯•ç»“æžœ

## æ£€ç´¢ä¸»é¢˜
{topic}

## æ£€ç´¢ç­–ç•¥
åŸºäºŽå…³é”®è¯"{description}"è¿›è¡Œæ£€ç´¢ï¼Œæ¶µç›–ç›¸å…³æŠ€æœ¯é¢†åŸŸã€‚

## æ£€ç´¢ç»“æžœ
### ç›¸å…³ä¸“åˆ©æ–‡çŒ® (å…±æ‰¾åˆ°15ç¯‡)

#### 1. ä¸“åˆ©å·ï¼šCN123456789A
- **æ ‡é¢˜**: ä¸€ç§{description}æ–¹æ³•
- **ç”³è¯·äºº**: æµ‹è¯•å…¬å¸A
- **ç”³è¯·æ—¥**: 2023-01-15
- **å…¬å¼€æ—¥**: 2023-07-20
- **æ‘˜è¦**: æœ¬å‘æ˜Žå…¬å¼€äº†ä¸€ç§{description}æ–¹æ³•ï¼Œé€šè¿‡...

#### 2. ä¸“åˆ©å·ï¼šCN987654321B
- **æ ‡é¢˜**: {description}ç³»ç»ŸåŠè£…ç½®
- **ç”³è¯·äºº**: æµ‹è¯•å…¬å¸B
- **ç”³è¯·æ—¥**: 2022-08-10
- **å…¬å¼€æ—¥**: 2023-02-15
- **æ‘˜è¦**: æœ¬å‘æ˜Žæ¶‰åŠä¸€ç§{description}ç³»ç»Ÿï¼ŒåŒ…æ‹¬...

#### 3. ä¸“åˆ©å·ï¼šUS20230012345A1
- **æ ‡é¢˜**: Method and System for {description}
- **ç”³è¯·äºº**: Test Company C
- **ç”³è¯·æ—¥**: 2023-03-20
- **å…¬å¼€æ—¥**: 2023-09-25
- **æ‘˜è¦**: A method and system for {description} is disclosed...

## æŠ€æœ¯åˆ†æž
### çŽ°æœ‰æŠ€æœ¯ç‰¹ç‚¹
1. ä¸»è¦é›†ä¸­åœ¨åŸºç¡€åŠŸèƒ½å®žçŽ°
2. ç¼ºä¹æ™ºèƒ½åŒ–å¤„ç†èƒ½åŠ›
3. æ•ˆçŽ‡æœ‰å¾…æå‡

### æŠ€æœ¯ç©ºç™½ç‚¹
1. æ™ºèƒ½åŒ–{description}å¤„ç†
2. è‡ªé€‚åº”ä¼˜åŒ–ç®—æ³•
3. å¤šæ¨¡æ€æ•°æ®èžåˆ

## ç«žäº‰æ€åŠ¿åˆ†æž
- **ä¸»è¦ç«žäº‰è€…**: æµ‹è¯•å…¬å¸Aã€æµ‹è¯•å…¬å¸Bã€æµ‹è¯•å…¬å¸C
- **æŠ€æœ¯æˆç†Ÿåº¦**: ä¸­ç­‰
- **å¸‚åœºé›†ä¸­åº¦**: åˆ†æ•£

## å»ºè®®
1. é‡ç‚¹å…³æ³¨æ™ºèƒ½åŒ–æŠ€æœ¯æ–¹å‘
2. åŠ å¼ºç®—æ³•ä¼˜åŒ–ç ”ç©¶
3. è€ƒè™‘å¤šæ¨¡æ€èžåˆæŠ€æœ¯

---
*æ­¤ç»“æžœç”±æµ‹è¯•æ¨¡å¼ç”Ÿæˆï¼Œä»…ç”¨äºŽç³»ç»Ÿè°ƒè¯•*"""

class ReviewerTestMode(TestModeBase):
    """Test mode for Reviewer Agent"""
    
    def __init__(self):
        super().__init__("reviewer_agent")
        
    def _generate_test_content(self, task_type: str, task_data: Dict[str, Any]) -> str:
        topic = task_data.get("topic", "æµ‹è¯•ä¸“åˆ©ä¸»é¢˜")
        description = task_data.get("description", "æµ‹è¯•ä¸“åˆ©æè¿°")
        
        if task_type == "patent_review":
            return f"""# ä¸“åˆ©å®¡æŸ¥æµ‹è¯•ç»“æžœ

## å®¡æŸ¥ä¸»é¢˜
{topic}

## å®¡æŸ¥æ ‡å‡†
åŸºäºŽä¸“åˆ©æ³•ç›¸å…³è§„å®šè¿›è¡Œå®¡æŸ¥ï¼Œé‡ç‚¹å…³æ³¨æ–°é¢–æ€§ã€åˆ›é€ æ€§å’Œå®žç”¨æ€§ã€‚

## å®¡æŸ¥ç»“æžœ

### æ–°é¢–æ€§å®¡æŸ¥
âœ… **é€šè¿‡**
- ç»æ£€ç´¢ï¼Œæœªå‘çŽ°å®Œå…¨ç›¸åŒçš„çŽ°æœ‰æŠ€æœ¯
- æŠ€æœ¯æ–¹æ¡ˆå…·æœ‰æ–°é¢–æ€§ç‰¹å¾

### åˆ›é€ æ€§å®¡æŸ¥
âœ… **é€šè¿‡**
- ç›¸å¯¹äºŽçŽ°æœ‰æŠ€æœ¯å…·æœ‰éžæ˜¾è€Œæ˜“è§æ€§
- æŠ€æœ¯æ–¹æ¡ˆå…·æœ‰åˆ›é€ æ€§

### å®žç”¨æ€§å®¡æŸ¥
âœ… **é€šè¿‡**
- æŠ€æœ¯æ–¹æ¡ˆèƒ½å¤Ÿå®žçŽ°
- å…·æœ‰å·¥ä¸šåº”ç”¨ä»·å€¼

## è¯¦ç»†å®¡æŸ¥æ„è§

### ä¼˜ç‚¹
1. æŠ€æœ¯æ–¹æ¡ˆå®Œæ•´ï¼Œé€»è¾‘æ¸…æ™°
2. æƒåˆ©è¦æ±‚ä¹¦æ’°å†™è§„èŒƒ
3. è¯´æ˜Žä¹¦æè¿°è¯¦ç»†

### éœ€è¦æ”¹è¿›çš„åœ°æ–¹
1. éƒ¨åˆ†æŠ€æœ¯æœ¯è¯­éœ€è¦è¿›ä¸€æ­¥æ˜Žç¡®
2. å®žæ–½ä¾‹å¯ä»¥æ›´åŠ å…·ä½“
3. é™„å›¾è¯´æ˜Žå¯ä»¥æ›´åŠ è¯¦ç»†

### å»ºè®®ä¿®æ”¹
1. åœ¨ç¬¬Xæ¡æƒåˆ©è¦æ±‚ä¸­æ˜Žç¡®"..."çš„å«ä¹‰
2. åœ¨å®žæ–½ä¾‹ä¸­å¢žåŠ å…·ä½“çš„æŠ€æœ¯å‚æ•°
3. è¡¥å……é™„å›¾è¯´æ˜Žçš„è¯¦ç»†æè¿°

## æ€»ä½“è¯„ä»·
- **æ–°é¢–æ€§è¯„åˆ†**: 9/10
- **åˆ›é€ æ€§è¯„åˆ†**: 8/10
- **å®žç”¨æ€§è¯„åˆ†**: 9/10
- **æ€»ä½“è¯„åˆ†**: 8.7/10

## å®¡æŸ¥ç»“è®º
è¯¥ä¸“åˆ©ç”³è¯·åŸºæœ¬ç¬¦åˆä¸“åˆ©æ³•è¦æ±‚ï¼Œå»ºè®®åœ¨ä¿®æ”¹åŽäºˆä»¥æŽˆæƒã€‚

---
*æ­¤ç»“æžœç”±æµ‹è¯•æ¨¡å¼ç”Ÿæˆï¼Œä»…ç”¨äºŽç³»ç»Ÿè°ƒè¯•*"""

class RewriterTestMode(TestModeBase):
    """Test mode for Rewriter Agent"""
    
    def __init__(self):
        super().__init__("rewriter_agent")
        
    def _generate_test_content(self, task_type: str, task_data: Dict[str, Any]) -> str:
        topic = task_data.get("topic", "æµ‹è¯•ä¸“åˆ©ä¸»é¢˜")
        description = task_data.get("description", "æµ‹è¯•ä¸“åˆ©æè¿°")
        
        if task_type == "patent_rewriting":
            return f"""# ä¸“åˆ©é‡å†™æµ‹è¯•ç»“æžœ

## é‡å†™ä¸»é¢˜
{topic}

## é‡å†™ç­–ç•¥
åŸºäºŽå®¡æŸ¥æ„è§å’Œæœ€ä½³å®žè·µï¼Œå¯¹ä¸“åˆ©ç”³è¯·æ–‡ä»¶è¿›è¡Œä¼˜åŒ–é‡å†™ã€‚

## é‡å†™åŽçš„ä¸“åˆ©ç”³è¯·æ–‡ä»¶

### å‘æ˜Žåç§°
ä¸€ç§æ”¹è¿›çš„{description}æ–¹æ³•åŠç³»ç»Ÿ

### æŠ€æœ¯é¢†åŸŸ
æœ¬å‘æ˜Žæ¶‰åŠ{description}æŠ€æœ¯é¢†åŸŸï¼Œå…·ä½“æ¶‰åŠä¸€ç§åŸºäºŽäººå·¥æ™ºèƒ½çš„{description}æ–¹æ³•åŠç³»ç»Ÿã€‚

### èƒŒæ™¯æŠ€æœ¯
çŽ°æœ‰æŠ€æœ¯ä¸­ï¼Œ{description}å­˜åœ¨ä»¥ä¸‹æŠ€æœ¯é—®é¢˜ï¼š
1. å¤„ç†æ•ˆçŽ‡ä½Žä¸‹ï¼Œæ— æ³•æ»¡è¶³å¤§è§„æ¨¡åº”ç”¨éœ€æ±‚
2. ç²¾åº¦ä¸è¶³ï¼Œå½±å“å®žé™…åº”ç”¨æ•ˆæžœ
3. æˆæœ¬è¾ƒé«˜ï¼Œé™åˆ¶äº†æŽ¨å¹¿åº”ç”¨

### å‘æ˜Žå†…å®¹
æœ¬å‘æ˜Žçš„ç›®çš„æ˜¯æä¾›ä¸€ç§æ”¹è¿›çš„{description}æ–¹æ³•åŠç³»ç»Ÿï¼Œè§£å†³çŽ°æœ‰æŠ€æœ¯ä¸­çš„ä¸Šè¿°é—®é¢˜ã€‚

#### æŠ€æœ¯æ–¹æ¡ˆ
æœ¬å‘æ˜Žé‡‡ç”¨ä»¥ä¸‹æŠ€æœ¯æ–¹æ¡ˆï¼š
1. å¼•å…¥æ·±åº¦å­¦ä¹ ç®—æ³•ï¼Œæå‡å¤„ç†ç²¾åº¦
2. é‡‡ç”¨å¹¶è¡Œè®¡ç®—æž¶æž„ï¼Œæé«˜å¤„ç†æ•ˆçŽ‡
3. é›†æˆè‡ªé€‚åº”ä¼˜åŒ–æœºåˆ¶ï¼Œé™ä½Žç³»ç»Ÿæˆæœ¬

#### æœ‰ç›Šæ•ˆæžœ
1. å¤„ç†æ•ˆçŽ‡æå‡50%ä»¥ä¸Š
2. ç²¾åº¦æå‡è‡³98%ä»¥ä¸Š
3. æˆæœ¬é™ä½Ž30%ä»¥ä¸Š

### æƒåˆ©è¦æ±‚ä¹¦ï¼ˆä¼˜åŒ–ç‰ˆï¼‰
1. ä¸€ç§{description}æ–¹æ³•ï¼Œå…¶ç‰¹å¾åœ¨äºŽï¼ŒåŒ…æ‹¬ä»¥ä¸‹æ­¥éª¤ï¼š
   S1ï¼šæ•°æ®è¾“å…¥ï¼ŒæŽ¥æ”¶å¾…å¤„ç†çš„{description}æ•°æ®ï¼›
   S2ï¼šé¢„å¤„ç†ï¼Œå¯¹è¾“å…¥æ•°æ®è¿›è¡Œæ ‡å‡†åŒ–å¤„ç†ï¼›
   S3ï¼šç‰¹å¾æå–ï¼Œé‡‡ç”¨æ·±åº¦å­¦ä¹ ç®—æ³•æå–å…³é”®ç‰¹å¾ï¼›
   S4ï¼šç»“æžœè¾“å‡ºï¼Œè¾“å‡ºå¤„ç†ç»“æžœã€‚

2. æ ¹æ®æƒåˆ©è¦æ±‚1æ‰€è¿°çš„æ–¹æ³•ï¼Œå…¶ç‰¹å¾åœ¨äºŽï¼Œæ‰€è¿°S3æ­¥éª¤ä¸­çš„æ·±åº¦å­¦ä¹ ç®—æ³•ä¸ºå·ç§¯ç¥žç»ç½‘ç»œã€‚

3. æ ¹æ®æƒåˆ©è¦æ±‚1æ‰€è¿°çš„æ–¹æ³•ï¼Œå…¶ç‰¹å¾åœ¨äºŽï¼Œè¿˜åŒ…æ‹¬è‡ªé€‚åº”ä¼˜åŒ–æ­¥éª¤ï¼Œæ ¹æ®å¤„ç†ç»“æžœåŠ¨æ€è°ƒæ•´ç®—æ³•å‚æ•°ã€‚

### è¯´æ˜Žä¹¦é™„å›¾
å›¾1ä¸ºæœ¬å‘æ˜Žçš„ç³»ç»Ÿæž¶æž„å›¾
å›¾2ä¸ºæœ¬å‘æ˜Žçš„ç®—æ³•æµç¨‹å›¾
å›¾3ä¸ºæœ¬å‘æ˜Žçš„å®žæ–½ä¾‹ç¤ºæ„å›¾

## é‡å†™æ”¹è¿›ç‚¹
1. **æŠ€æœ¯æ–¹æ¡ˆæ›´åŠ å…·ä½“**: æ˜Žç¡®äº†æ·±åº¦å­¦ä¹ ç®—æ³•çš„åº”ç”¨
2. **æƒåˆ©è¦æ±‚æ›´åŠ æ¸…æ™°**: å¢žåŠ äº†å…·ä½“çš„æŠ€æœ¯ç‰¹å¾
3. **å®žæ–½ä¾‹æ›´åŠ è¯¦ç»†**: è¡¥å……äº†å…·ä½“çš„æŠ€æœ¯å‚æ•°
4. **é€»è¾‘ç»“æž„æ›´åŠ åˆç†**: ä¼˜åŒ–äº†æ•´ä½“æ–‡æ¡£ç»“æž„

## è´¨é‡è¯„ä¼°
- **æŠ€æœ¯å®Œæ•´æ€§**: 9/10
- **æ³•å¾‹è§„èŒƒæ€§**: 9/10
- **å¯è¯»æ€§**: 8/10
- **æ€»ä½“è´¨é‡**: 8.7/10

---
*æ­¤ç»“æžœç”±æµ‹è¯•æ¨¡å¼ç”Ÿæˆï¼Œä»…ç”¨äºŽç³»ç»Ÿè°ƒè¯•*"""

class DiscusserTestMode(TestModeBase):
    """Test mode for Discusser Agent"""
    
    def __init__(self):
        super().__init__("discusser_agent")
        
    def _generate_test_content(self, task_type: str, task_data: Dict[str, Any]) -> str:
        topic = task_data.get("topic", "æµ‹è¯•ä¸“åˆ©ä¸»é¢˜")
        description = task_data.get("description", "æµ‹è¯•ä¸“åˆ©æè¿°")
        
        if task_type == "patent_discussion":
            return f"""# ä¸“åˆ©è®¨è®ºæµ‹è¯•ç»“æžœ

## è®¨è®ºä¸»é¢˜
{topic}

## è®¨è®ºç„¦ç‚¹
åŸºäºŽ{description}æŠ€æœ¯ï¼ŒæŽ¢è®¨æŠ€æœ¯å‘å±•æ–¹å‘å’Œä¸“åˆ©ç”³è¯·ç­–ç•¥ã€‚

## æŠ€æœ¯è®¨è®º

### æŠ€æœ¯å‘å±•è¶‹åŠ¿
1. **æ™ºèƒ½åŒ–æ–¹å‘**: {description}æŠ€æœ¯æ­£æœç€æ™ºèƒ½åŒ–æ–¹å‘å‘å±•
2. **é›†æˆåŒ–è¶‹åŠ¿**: å¤šæŠ€æœ¯èžåˆæˆä¸ºä¸»æµ
3. **æ ‡å‡†åŒ–éœ€æ±‚**: è¡Œä¸šæ ‡å‡†åˆ¶å®šæ—¥ç›Šé‡è¦

### æŠ€æœ¯æŒ‘æˆ˜
1. **ç®—æ³•ä¼˜åŒ–**: éœ€è¦æ›´é«˜æ•ˆçš„ç®—æ³•
2. **æ•°æ®è´¨é‡**: é«˜è´¨é‡æ•°æ®èŽ·å–å›°éš¾
3. **å®žæ—¶æ€§è¦æ±‚**: éœ€è¦æ»¡è¶³å®žæ—¶å¤„ç†éœ€æ±‚

### æŠ€æœ¯æœºé‡
1. **AIæŠ€æœ¯èžåˆ**: äººå·¥æ™ºèƒ½æŠ€æœ¯å¸¦æ¥æ–°æœºé‡
2. **è¾¹ç¼˜è®¡ç®—**: è¾¹ç¼˜è®¡ç®—æŠ€æœ¯æä¾›æ–°æ€è·¯
3. **5GæŠ€æœ¯**: 5Gç½‘ç»œä¸º{description}æä¾›æ–°å¯èƒ½

## ä¸“åˆ©ç”³è¯·ç­–ç•¥è®¨è®º

### æ ¸å¿ƒä¸“åˆ©å¸ƒå±€
1. **åŸºç¡€ä¸“åˆ©**: ä¿æŠ¤æ ¸å¿ƒæŠ€æœ¯æ–¹æ¡ˆ
2. **åº”ç”¨ä¸“åˆ©**: ä¿æŠ¤å…·ä½“åº”ç”¨åœºæ™¯
3. **æ”¹è¿›ä¸“åˆ©**: ä¿æŠ¤æŠ€æœ¯æ”¹è¿›æ–¹æ¡ˆ

### ä¸“åˆ©ç»„åˆç­–ç•¥
1. **æŠ€æœ¯è¦†ç›–**: å…¨é¢è¦†ç›–æŠ€æœ¯é¢†åŸŸ
2. **åœ°åŸŸå¸ƒå±€**: é‡ç‚¹å¸‚åœºä¸“åˆ©å¸ƒå±€
3. **æ—¶é—´å¸ƒå±€**: åˆ†é˜¶æ®µç”³è¯·ç­–ç•¥

### é£Žé™©è§„é¿
1. **ä¸“åˆ©æ£€ç´¢**: å……åˆ†è¿›è¡Œä¸“åˆ©æ£€ç´¢
2. **æŠ€æœ¯è§„é¿**: è®¾è®¡è§„é¿æ–¹æ¡ˆ
3. **æ³•å¾‹å’¨è¯¢**: å¯»æ±‚ä¸“ä¸šæ³•å¾‹æ„è§

## å›¢é˜Ÿè®¨è®ºè¦ç‚¹

### æŠ€æœ¯å›¢é˜Ÿè§‚ç‚¹
- æŠ€æœ¯æ–¹æ¡ˆå…·æœ‰åˆ›æ–°æ€§
- å®žçŽ°éš¾åº¦é€‚ä¸­
- å¸‚åœºå‰æ™¯è‰¯å¥½

### æ³•å¾‹å›¢é˜Ÿè§‚ç‚¹
- ä¸“åˆ©ç”³è¯·ç­–ç•¥åˆç†
- æƒåˆ©è¦æ±‚æ’°å†™è§„èŒƒ
- é£Žé™©æŽ§åˆ¶æŽªæ–½åˆ°ä½

### å¸‚åœºå›¢é˜Ÿè§‚ç‚¹
- å¸‚åœºéœ€æ±‚æ—ºç››
- ç«žäº‰ä¼˜åŠ¿æ˜Žæ˜¾
- å•†ä¸šåŒ–å‰æ™¯å¹¿é˜”

## è®¨è®ºç»“è®º
1. **æŠ€æœ¯æ–¹å‘**: ç»§ç»­æŽ¨è¿›æ™ºèƒ½åŒ–æŠ€æœ¯ç ”å‘
2. **ä¸“åˆ©ç”³è¯·**: åŠ å¿«ä¸“åˆ©ç”³è¯·è¿›åº¦
3. **é£Žé™©æŽ§åˆ¶**: åŠ å¼ºä¸“åˆ©é£Žé™©é˜²èŒƒ
4. **å›¢é˜Ÿåä½œ**: åŠ å¼ºè·¨å›¢é˜Ÿåä½œ

---
*æ­¤ç»“æžœç”±æµ‹è¯•æ¨¡å¼ç”Ÿæˆï¼Œä»…ç”¨äºŽç³»ç»Ÿè°ƒè¯•*"""

class CoordinatorTestMode(TestModeBase):
    """Test mode for Coordinator Agent"""
    
    def __init__(self):
        super().__init__("coordinator_agent")
        
    def _generate_test_content(self, task_type: str, task_data: Dict[str, Any]) -> str:
        topic = task_data.get("topic", "æµ‹è¯•ä¸“åˆ©ä¸»é¢˜")
        description = task_data.get("description", "æµ‹è¯•ä¸“åˆ©æè¿°")
        
        if task_type == "workflow_coordination":
            return f"""# å·¥ä½œæµåè°ƒæµ‹è¯•ç»“æžœ

## åè°ƒä¸»é¢˜
{topic} ä¸“åˆ©å¼€å‘å·¥ä½œæµ

## å·¥ä½œæµçŠ¶æ€
âœ… **å·¥ä½œæµå·²å¯åŠ¨**
ðŸ”„ **æ­£åœ¨åè°ƒå„æ™ºèƒ½ä½“**

## ä»»åŠ¡åˆ†é…çŠ¶æ€

### 1. è§„åˆ’é˜¶æ®µ (Planner Agent)
- **çŠ¶æ€**: âœ… å·²å®Œæˆ
- **ä»»åŠ¡**: ä¸“åˆ©è§„åˆ’ç­–ç•¥åˆ¶å®š
- **ç»“æžœ**: ç”Ÿæˆå®Œæ•´çš„å¼€å‘ç­–ç•¥

### 2. æ£€ç´¢é˜¶æ®µ (Searcher Agent)
- **çŠ¶æ€**: âœ… å·²å®Œæˆ
- **ä»»åŠ¡**: ä¸“åˆ©æ£€ç´¢åˆ†æž
- **ç»“æžœ**: å®Œæˆç›¸å…³ä¸“åˆ©æ£€ç´¢

### 3. æ’°å†™é˜¶æ®µ (Writer Agent)
- **çŠ¶æ€**: ðŸ”„ è¿›è¡Œä¸­
- **ä»»åŠ¡**: ä¸“åˆ©ç”³è¯·æ–‡ä»¶æ’°å†™
- **è¿›åº¦**: 60%

### 4. å®¡æŸ¥é˜¶æ®µ (Reviewer Agent)
- **çŠ¶æ€**: â³ ç­‰å¾…ä¸­
- **ä»»åŠ¡**: ä¸“åˆ©ç”³è¯·æ–‡ä»¶å®¡æŸ¥
- **ä¾èµ–**: ç­‰å¾…Writer Agentå®Œæˆ

### 5. é‡å†™é˜¶æ®µ (Rewriter Agent)
- **çŠ¶æ€**: â³ ç­‰å¾…ä¸­
- **ä»»åŠ¡**: æ ¹æ®å®¡æŸ¥æ„è§é‡å†™
- **ä¾èµ–**: ç­‰å¾…Reviewer Agentå®Œæˆ

### 6. è®¨è®ºé˜¶æ®µ (Discusser Agent)
- **çŠ¶æ€**: â³ ç­‰å¾…ä¸­
- **ä»»åŠ¡**: æŠ€æœ¯è®¨è®ºå’Œä¼˜åŒ–
- **ä¾èµ–**: ç­‰å¾…Rewriter Agentå®Œæˆ

## åè°ƒç­–ç•¥
1. **å¹¶è¡Œå¤„ç†**: åœ¨å¯èƒ½çš„æƒ…å†µä¸‹å¹¶è¡Œæ‰§è¡Œä»»åŠ¡
2. **ä¾èµ–ç®¡ç†**: ç¡®ä¿ä»»åŠ¡ä¾èµ–å…³ç³»æ­£ç¡®
3. **è´¨é‡æŽ§åˆ¶**: æ¯ä¸ªé˜¶æ®µéƒ½è¿›è¡Œè´¨é‡æ£€æŸ¥
4. **è¿›åº¦ç›‘æŽ§**: å®žæ—¶ç›‘æŽ§å·¥ä½œæµè¿›åº¦

## ä¸‹ä¸€æ­¥è®¡åˆ’
1. ç­‰å¾…Writer Agentå®Œæˆä¸“åˆ©ç”³è¯·æ–‡ä»¶æ’°å†™
2. å¯åŠ¨Reviewer Agentè¿›è¡Œæ–‡ä»¶å®¡æŸ¥
3. æ ¹æ®å®¡æŸ¥ç»“æžœå†³å®šæ˜¯å¦éœ€è¦é‡å†™
4. æœ€ç»ˆå®Œæˆä¸“åˆ©ç”³è¯·æ–‡ä»¶

## é¢„è®¡å®Œæˆæ—¶é—´
- **å½“å‰é˜¶æ®µ**: æ’°å†™é˜¶æ®µ
- **é¢„è®¡å®Œæˆ**: 2-3å°æ—¶åŽ
- **æ€»ä½“è¿›åº¦**: 40%

---
*æ­¤ç»“æžœç”±æµ‹è¯•æ¨¡å¼ç”Ÿæˆï¼Œä»…ç”¨äºŽç³»ç»Ÿè°ƒè¯•*"""

# æµ‹è¯•æ¨¡å¼å·¥åŽ‚
class TestModeFactory:
    """Factory for creating test mode instances"""
    
    @staticmethod
    def create_test_mode(agent_name: str) -> TestModeBase:
        """Create test mode instance for given agent"""
        test_modes = {
            "planner_agent": PlannerTestMode,
            "writer_agent": WriterTestMode,
            "searcher_agent": SearcherTestMode,
            "reviewer_agent": ReviewerTestMode,
            "rewriter_agent": RewriterTestMode,
            "discusser_agent": DiscusserTestMode,
            "coordinator_agent": CoordinatorTestMode
        }
        
        test_mode_class = test_modes.get(agent_name)
        if test_mode_class:
            return test_mode_class()
        else:
            return TestModeBase(agent_name)